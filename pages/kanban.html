<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çœ‹æ¿ - NexusAI</title>
  <!-- Head Loaderï¼ˆé›†ä¸­ç®¡ç†æ ¸å¿ƒ CSS/Fonts/ç‰ˆæœ¬è™Ÿï¼‰ -->
  <script src="../js/head-loader.js"></script>
  <style>
    .kanban-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-6);
      flex-wrap: wrap;
      gap: var(--spacing-4);
    }

    .kanban-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .kanban-actions {
      display: flex;
      gap: var(--spacing-3);
    }

    .kanban-board {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--spacing-4);
      margin-bottom: var(--spacing-6);
    }

    .kanban-column {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-4);
      min-height: 500px;
      display: flex;
      flex-direction: column;
    }

    .kanban-column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-4);
      padding-bottom: var(--spacing-3);
      border-bottom: 1px solid var(--glass-border);
    }

    .kanban-column-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }

    .kanban-column-count {
      background: var(--bg-secondary);
      color: var(--text-secondary);
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-full);
      font-size: 0.875rem;
    }

    .kanban-cards {
      flex: 1;
      overflow-y: auto;
      padding: var(--spacing-2) 0;
    }

    .kanban-card {
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur-light));
      -webkit-backdrop-filter: blur(var(--glass-blur-light));
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-4);
      margin-bottom: var(--spacing-3);
      cursor: move;
      box-shadow: var(--shadow-sm), inset 0 1px 0 var(--glass-highlight);
      transition: all 0.2s ease;
    }

    .kanban-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }

    .kanban-card.dragging {
      opacity: 0.5;
    }

    .kanban-card-title {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-2);
    }

    .kanban-card-description {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-3);
      line-height: 1.5;
    }

    .kanban-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--spacing-3);
      padding-top: var(--spacing-3);
      border-top: 1px solid var(--glass-border);
    }

    .kanban-card-tags {
      display: flex;
      gap: var(--spacing-2);
      flex-wrap: wrap;
    }

    .kanban-card-tag {
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-full);
      font-size: 0.75rem;
      font-weight: 500;
    }

    .tag-bug { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
    .tag-feature { background: rgba(59, 130, 246, 0.2); color: var(--primary); }
    .tag-enhancement { background: rgba(16, 185, 129, 0.2); color: var(--success); }
    .tag-documentation { background: rgba(139, 92, 246, 0.2); color: var(--secondary); }

    .kanban-card-assignee {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .add-card-btn {
      width: 100%;
      padding: var(--spacing-3);
      background: var(--bg-secondary);
      border: 1px dashed var(--glass-border);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.9rem;
    }

    .add-card-btn:hover {
      background: var(--glass-hover);
      border-color: var(--primary);
      color: var(--primary);
    }

    @media (max-width: 768px) {
      .kanban-board {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Skip Link (ç„¡éšœç¤™) -->
  <a href="#main-content" class="skip-link">è·³è‡³ä¸»è¦å…§å®¹</a>

  <div class="sidebar-layout">
    <nav id="sidebar-container" class="sidebar-layout__sidebar" aria-label="å´é‚Šå°èˆª"></nav>
    <main id="main-content" class="sidebar-layout__main">
      <!-- Header -->
      <div class="kanban-header">
        <h1 class="kanban-title" data-lang="kanban.pageTitle">å°ˆæ¡ˆçœ‹æ¿</h1>
        <div class="kanban-actions">
          <input type="text" class="form-input" placeholder="æœå°‹ä»»å‹™..." data-lang-placeholder="kanban.searchPlaceholder" style="width: 200px;">
          <select class="form-input" style="width: 150px;">
            <option data-lang="kanban.filter.allMembers">æ‰€æœ‰æˆå“¡</option>
            <option>Alex</option>
            <option>Sarah</option>
            <option>Mike</option>
          </select>
          <button class="btn btn--secondary btn--sm" data-lang-toggle aria-label="åˆ‡æ›èªè¨€">
            <span data-lang-display>ä¸­</span>
          </button>
          <button class="btn btn--secondary btn--sm" data-theme-toggle aria-label="åˆ‡æ›ä¸»é¡Œ">
            <i data-lucide="moon" data-theme-icon></i>
          </button>
          <button class="btn btn-primary" onclick="addNewCard()" data-lang="kanban.addTask">+ æ–°å¢ä»»å‹™</button>
        </div>
      </div>

      <!-- Kanban Board -->
      <div class="kanban-board">
        <!-- å¾…è¾¦ -->
        <div class="kanban-column" data-status="todo">
          <div class="kanban-column-header">
            <div class="kanban-column-title">
              <span>ğŸ“‹</span>
              <span data-lang="kanban.columns.todo">å¾…è¾¦</span>
            </div>
            <span class="kanban-column-count">5</span>
          </div>
          <div class="kanban-cards" id="todo-cards">
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.todo1.title">è¨­è¨ˆæ–°çš„ç™»å…¥é é¢</div>
              <div class="kanban-card-description" data-lang="kanban.card.todo1.desc">æ ¹æ“šæœ€æ–°çš„è¨­è¨ˆè¦ç¯„é‡æ–°è¨­è¨ˆç™»å…¥ä»‹é¢</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-feature" data-lang="kanban.tag.feature">åŠŸèƒ½</span>
                </div>
                <div class="kanban-card-assignee">A</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.todo2.title">ä¿®å¾©è³‡æ–™è¡¨æ’åºå•é¡Œ</div>
              <div class="kanban-card-description" data-lang="kanban.card.todo2.desc">é»æ“Šè¡¨é ­æ’åºæ™‚å¶çˆ¾æœƒå¤±æ•—</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-bug" data-lang="kanban.tag.bug">éŒ¯èª¤</span>
                </div>
                <div class="kanban-card-assignee">S</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.todo3.title">æ›´æ–° API æ–‡æª”</div>
              <div class="kanban-card-description" data-lang="kanban.card.todo3.desc">è£œå……æ–°å¢çš„ API ç«¯é»èªªæ˜</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-documentation" data-lang="kanban.tag.docs">æ–‡ä»¶</span>
                </div>
                <div class="kanban-card-assignee">M</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.todo4.title">å„ªåŒ–æœå°‹æ•ˆèƒ½</div>
              <div class="kanban-card-description" data-lang="kanban.card.todo4.desc">å¤§é‡è³‡æ–™æ™‚æœå°‹é€Ÿåº¦è¼ƒæ…¢</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-enhancement" data-lang="kanban.tag.enhancement">æ”¹å–„</span>
                </div>
                <div class="kanban-card-assignee">A</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.todo5.title">æ–°å¢æ·±è‰²æ¨¡å¼åˆ‡æ›</div>
              <div class="kanban-card-description" data-lang="kanban.card.todo5.desc">å¯¦ä½œå…¨ç«™æ·±è‰²æ¨¡å¼</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-feature" data-lang="kanban.tag.feature">åŠŸèƒ½</span>
                </div>
                <div class="kanban-card-assignee">S</div>
              </div>
            </div>
          </div>
          <button class="add-card-btn" onclick="addNewCard('todo')" data-lang="kanban.addCard">+ æ–°å¢å¡ç‰‡</button>
        </div>

        <!-- é€²è¡Œä¸­ -->
        <div class="kanban-column" data-status="inprogress">
          <div class="kanban-column-header">
            <div class="kanban-column-title">
              <span>âš™ï¸</span>
              <span data-lang="kanban.columns.inProgress">é€²è¡Œä¸­</span>
            </div>
            <span class="kanban-column-count">3</span>
          </div>
          <div class="kanban-cards" id="inprogress-cards">
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.inProgress1.title">å¯¦ä½œæ‹–æ”¾åŠŸèƒ½</div>
              <div class="kanban-card-description" data-lang="kanban.card.inProgress1.desc">é–‹ç™¼çœ‹æ¿çš„æ‹–æ”¾æ’åºåŠŸèƒ½</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-feature" data-lang="kanban.tag.feature">åŠŸèƒ½</span>
                </div>
                <div class="kanban-card-assignee">A</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.inProgress2.title">æ•´åˆ i18n ç³»çµ±</div>
              <div class="kanban-card-description" data-lang="kanban.card.inProgress2.desc">å¯¦ä½œå¤šèªè¨€æ”¯æ´</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-feature" data-lang="kanban.tag.feature">åŠŸèƒ½</span>
                </div>
                <div class="kanban-card-assignee">M</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.inProgress3.title">æ’°å¯«å–®å…ƒæ¸¬è©¦</div>
              <div class="kanban-card-description" data-lang="kanban.card.inProgress3.desc">ç‚ºæ ¸å¿ƒåŠŸèƒ½å¢åŠ æ¸¬è©¦è¦†è“‹ç‡</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-enhancement" data-lang="kanban.tag.enhancement">æ”¹å–„</span>
                </div>
                <div class="kanban-card-assignee">S</div>
              </div>
            </div>
          </div>
          <button class="add-card-btn" onclick="addNewCard('inprogress')" data-lang="kanban.addCard">+ æ–°å¢å¡ç‰‡</button>
        </div>

        <!-- å·²å®Œæˆ -->
        <div class="kanban-column" data-status="done">
          <div class="kanban-column-header">
            <div class="kanban-column-title">
              <span>âœ…</span>
              <span data-lang="kanban.columns.done">å·²å®Œæˆ</span>
            </div>
            <span class="kanban-column-count">4</span>
          </div>
          <div class="kanban-cards" id="done-cards">
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.done1.title">å»ºç«‹ Glassmorphism æ¨£å¼ç³»çµ±</div>
              <div class="kanban-card-description" data-lang="kanban.card.done1.desc">å®Œæˆæ¯›ç»ç’ƒè¨­è¨ˆç³»çµ±</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-feature" data-lang="kanban.tag.feature">åŠŸèƒ½</span>
                </div>
                <div class="kanban-card-assignee">A</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.done2.title">è¨­è¨ˆéŸ¿æ‡‰å¼å°èˆªåˆ—</div>
              <div class="kanban-card-description" data-lang="kanban.card.done2.desc">RWD å°èˆªå…ƒä»¶</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-feature" data-lang="kanban.tag.feature">åŠŸèƒ½</span>
                </div>
                <div class="kanban-card-assignee">S</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.done3.title">å¯¦ä½œä¸»é¡Œåˆ‡æ›</div>
              <div class="kanban-card-description" data-lang="kanban.card.done3.desc">æ·ºè‰²/æ·±è‰²æ¨¡å¼åˆ‡æ›</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-feature" data-lang="kanban.tag.feature">åŠŸèƒ½</span>
                </div>
                <div class="kanban-card-assignee">M</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.done4.title">å»ºç«‹è¨­è¨ˆè¦ç¯„æ–‡æª”</div>
              <div class="kanban-card-description" data-lang="kanban.card.done4.desc">å®Œæ•´çš„è¨­è¨ˆç³»çµ±èªªæ˜</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-documentation" data-lang="kanban.tag.docs">æ–‡ä»¶</span>
                </div>
                <div class="kanban-card-assignee">A</div>
              </div>
            </div>
          </div>
          <button class="add-card-btn" onclick="addNewCard('done')" data-lang="kanban.addCard">+ æ–°å¢å¡ç‰‡</button>
        </div>

        <!-- å·²å°å­˜ -->
        <div class="kanban-column" data-status="archived">
          <div class="kanban-column-header">
            <div class="kanban-column-title">
              <span>ğŸ“¦</span>
              <span data-lang="kanban.columns.archived">å·²å°å­˜</span>
            </div>
            <span class="kanban-column-count">2</span>
          </div>
          <div class="kanban-cards" id="archived-cards">
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.archived1.title">ç ”ç©¶ç«¶å“åˆ†æ</div>
              <div class="kanban-card-description" data-lang="kanban.card.archived1.desc">åˆ†æå¸‚å ´ä¸Šé¡ä¼¼ç”¢å“</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-documentation" data-lang="kanban.tag.docs">æ–‡ä»¶</span>
                </div>
                <div class="kanban-card-assignee">M</div>
              </div>
            </div>
            <div class="kanban-card" draggable="true">
              <div class="kanban-card-title" data-lang="kanban.card.archived2.title">åˆç‰ˆåŸå‹è¨­è¨ˆ</div>
              <div class="kanban-card-description" data-lang="kanban.card.archived2.desc">æ—©æœŸè¨­è¨ˆæ¦‚å¿µ</div>
              <div class="kanban-card-footer">
                <div class="kanban-card-tags">
                  <span class="kanban-card-tag tag-feature" data-lang="kanban.tag.feature">åŠŸèƒ½</span>
                </div>
                <div class="kanban-card-assignee">S</div>
              </div>
            </div>
          </div>
          <button class="add-card-btn" onclick="addNewCard('archived')" data-lang="kanban.addCard">+ æ–°å¢å¡ç‰‡</button>
        </div>
      </div>
    </main>
  </div>

  <script type="module">
    import { initTheme } from '../js/theme.js';
    import { initI18n, t } from '../js/i18n.js';
    import { render as renderSidebar } from '../js/components/sidebar.js';

    document.addEventListener('DOMContentLoaded', async () => {
      initTheme();
      initI18n();
      const sidebarContainer = document.getElementById('sidebar-container');
      if (sidebarContainer) renderSidebar(sidebarContainer);
      // åˆå§‹åŒ– Lucide Icons
      const { initIcons } = await import('../js/lucide-icons.js');
      await initIcons();

      // Drag and Drop
      initDragAndDrop();
      updateCardCounts();
    });

    function initDragAndDrop() {
      let draggedCard = null;

      document.querySelectorAll('.kanban-card').forEach(card => {
        card.addEventListener('dragstart', (e) => {
          draggedCard = card;
          card.classList.add('dragging');
        });

        card.addEventListener('dragend', () => {
          card.classList.remove('dragging');
          updateCardCounts();
        });
      });

      document.querySelectorAll('.kanban-cards').forEach(column => {
        column.addEventListener('dragover', (e) => {
          e.preventDefault();
          const afterElement = getDragAfterElement(column, e.clientY);
          if (draggedCard) {
            if (afterElement == null) {
              column.appendChild(draggedCard);
            } else {
              column.insertBefore(draggedCard, afterElement);
            }
          }
        });
      });
    }

    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.kanban-card:not(.dragging)')];
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function updateCardCounts() {
      document.querySelectorAll('.kanban-column').forEach(column => {
        const count = column.querySelectorAll('.kanban-card').length;
        const countElement = column.querySelector('.kanban-column-count');
        if (countElement) {
          countElement.textContent = count;
        }
      });
    }

    window.addNewCard = function(status = 'todo') {
      const title = prompt(t('kanban.prompt.taskTitle'));
      if (!title) return;

      const card = document.createElement('div');
      card.className = 'kanban-card';
      card.draggable = true;
      card.innerHTML = `
        <div class="kanban-card-title">${title}</div>
        <div class="kanban-card-description">${t('kanban.newTask.desc')}</div>
        <div class="kanban-card-footer">
          <div class="kanban-card-tags">
            <span class="kanban-card-tag tag-feature">${t('kanban.tag.feature')}</span>
          </div>
          <div class="kanban-card-assignee">N</div>
        </div>
      `;

      // Add drag events
      card.addEventListener('dragstart', (e) => {
        card.classList.add('dragging');
      });
      card.addEventListener('dragend', () => {
        card.classList.remove('dragging');
        updateCardCounts();
      });

      const targetColumn = document.getElementById(`${status}-cards`);
      if (targetColumn) {
        targetColumn.appendChild(card);
        updateCardCounts();
      }
    };
  </script>
</body>
</html>
